(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function ae(){let e=0;const n=new Set,t=new Map,i=h=>(t.has(h)||t.set(h,new Map),t.get(h)),s=()=>{const h=e++;return n.add(h),h},a=h=>{if(n.has(h)){for(const g of t.values())g.delete(h);n.delete(h)}},p=h=>n.has(h),c=(h,g,u)=>{if(!n.has(h))return;i(g).set(h,u)},l=(h,g)=>{const u=t.get(g);if(u)return u.get(h)},o=(h,g)=>{const u=t.get(g);u&&u.delete(h)},d=(h,g)=>{const u=t.get(g);return u?u.has(h):!1};return{createEntity:s,destroyEntity:a,isAlive:p,addComponent:c,getComponent:l,removeComponent:o,hasComponent:d,getEntitiesWithComponents:h=>{const g=[];for(const u of n){let S=!0;for(const v of h)if(!d(u,v)){S=!1;break}S&&g.push(u)}return g},getAllEntities:()=>Array.from(n),clear:()=>{n.clear();for(const h of t.values())h.clear()}}}const re=3;function ce(e={}){const{initialLives:n=re}=e,t=ae();let i="ready",s=0,a=n,p=1,c=0,l=0,o=0;return{entities:t,getGameState:()=>i,setGameState:P=>{i=P},getScore:()=>s,addScore:P=>{P>0&&(s+=P)},resetScore:()=>{s=0},getLives:()=>a,loseLife:()=>{a>0&&a--},addLife:()=>{a++},resetLives:()=>{a=n},getLevel:()=>p,nextLevel:()=>{p++},resetLevel:()=>{p=1},getPowerUpTimeRemaining:()=>c,setPowerUpTime:P=>{c=P},decreasePowerUpTime:P=>{c=Math.max(0,c-P)},isPowerUpActive:()=>c>0,getDeltaTime:()=>l,setDeltaTime:P=>{l=P},getGhostEatenStreak:()=>o,incrementGhostEatenStreak:()=>{o++},resetGhostEatenStreak:()=>{o=0},reset:()=>{t.clear(),i="ready",s=0,a=n,p=1,c=0,l=0,o=0}}}function le(){const e=new Map,n=c=>(e.has(c)||e.set(c,new Set),e.get(c)),t=(c,l)=>{const o=n(c);return o.add(l),()=>{o.delete(l)}};return{subscribe:t,once:(c,l)=>{const d=t(c,r=>{d(),l(r)});return d},dispatch:(c,l)=>{const o=e.get(c);if(o)for(const d of o)d(l)},getSubscriberCount:c=>{const l=e.get(c);return l?l.size:0},clear:()=>{e.clear()}}}const T={INPUT_DIRECTION:"game:input:direction",INPUT_PAUSE:"game:input:pause",INPUT_START:"game:input:start",INPUT_RESTART:"game:input:restart",GAME_STARTED:"game:started",GAME_PAUSED:"game:paused",GAME_RESUMED:"game:resumed",GAME_OVER:"game:over",GAME_RESTART:"game:restart",LEVEL_COMPLETE:"game:level:complete",PELLET_EATEN:"game:pellet:eaten",POWER_PELLET_EATEN:"game:power:eaten",GHOST_EATEN:"game:ghost:eaten",PLAYER_DIED:"game:player:died",POWER_UP_STARTED:"game:powerup:started",POWER_UP_WARNING:"game:powerup:warning",POWER_UP_ENDED:"game:powerup:ended",GHOST_MODE_CHANGE:"game:ghost:mode"};function G(e){const n=e.entities.getEntitiesWithComponents(["playerControlled"]);return n.length>0?n[0]:null}function z(e){const n=G(e);return n===null?null:e.entities.getComponent(n,"position")??null}function $(e){const n=G(e);if(n===null)return null;const t=e.entities.getComponent(n,"velocity");return(t==null?void 0:t.direction)??null}function M(e){return e.entities.getEntitiesWithComponents(["ghostAI"])}function de(e,n){const t=e.entities.getComponent(n,"ghostAI");return(t==null?void 0:t.mode)??null}function ue(e,n){const t=e.entities.getComponent(n,"ghostAI");return(t==null?void 0:t.type)??null}function H(e,n){const t=e.entities.getComponent(n,"vulnerable");return t!==void 0&&t.remainingTime>0}function pe(e,n){const t=e.entities.getComponent(n,"vulnerable");return(t==null?void 0:t.flashing)??!1}function fe(e){const n=M(e),t=[];for(const i of n){const s=e.entities.getComponent(i,"ghostAI"),a=e.entities.getComponent(i,"position");s&&a&&t.push({id:i,type:s.type,mode:s.mode,position:a,isVulnerable:H(e,i),isFlashing:pe(e,i)})}return t}function V(e){return e.entities.getEntitiesWithComponents(["edible","position"])}function ge(e){return e.entities.getEntitiesWithComponents(["edible","powerUp","position"])}function me(e){return V(e).length}function he(e){return e.getScore()}function ye(e){return e.getLives()}function Ee(e){return e.getLevel()}function Se(e){return e.getGameState()}function Ce(e){let n=null,t=!1,i=!1,s=!1;const a=e.subscribe(T.INPUT_DIRECTION,r=>{n=r.direction}),p=e.subscribe(T.INPUT_START,()=>{t=!0}),c=e.subscribe(T.INPUT_PAUSE,()=>{i=!0}),l=e.subscribe(T.INPUT_RESTART,()=>{s=!0});return{update:r=>{if(s){s=!1,t=!1,i=!1,n=null,e.dispatch(T.GAME_RESTART,void 0);return}if(t&&(r.getGameState()==="ready"&&r.setGameState("playing"),t=!1),i){const f=r.getGameState();f==="playing"?r.setGameState("paused"):f==="paused"&&r.setGameState("playing"),i=!1}if(n!==null){const f=G(r);if(f!==null){const y=r.entities.getComponent(f,"velocity");y&&r.entities.addComponent(f,"velocity",{...y,nextDirection:n})}n=null}},destroy:()=>{a(),p(),c(),l()}}}const m=20,k=28,F=2,ve=F*.8,j=F*.75,Te=F*.5,be=2e3,_e=7e3,Ae=2e4,Pe=1500,Q=14;function O(e,n,t,i=!1){if(t<0||t>=e.length)return!1;if(n<0||n>=e[0].length)return t===Q;const s=e[t][n];return!(s.type==="wall"||i&&(s.type==="ghost-house"||s.type==="ghost-door"))}function Le(e,n,t){switch(t){case"up":return{x:e,y:n-1};case"down":return{x:e,y:n+1};case"left":return{x:e-1,y:n};case"right":return{x:e+1,y:n}}}function Ge(e,n,t=m/4){const i=Math.floor(e/m)*m+m/2,s=Math.floor(n/m)*m+m/2;return Math.abs(e-i)<=t&&Math.abs(n-s)<=t}function Ie(e){return{update:t=>{if(t.getGameState()!=="playing")return;const i=t.getDeltaTime();if(i===0)return;const s=t.entities.getEntitiesWithComponents(["position","velocity"]);for(const a of s){const p=t.entities.getComponent(a,"position"),c=t.entities.getComponent(a,"velocity"),l=t.entities.hasComponent(a,"playerControlled");if(c.direction===null&&c.nextDirection===null)continue;let{pixelX:o,pixelY:d}=p,r=c.direction,f=c.nextDirection,y=Math.floor(o/m),h=Math.floor(d/m);if(f!==null){if(r==="left"&&f==="right"||r==="right"&&f==="left"||r==="up"&&f==="down"||r==="down"&&f==="up")r=f,f=null;else if(Ge(o,d)){const u=Le(y,h,f);O(e,u.x,u.y,l)&&(r=f,f=null,o=y*m+m/2,d=h*m+m/2)}}if(r!==null){const g=c.speed*(i/16.67);let u=o,S=d;switch(r){case"up":S-=g;break;case"down":S+=g;break;case"left":u-=g;break;case"right":u+=g;break}h===Q&&(u<0?u=k*m+u:u>=k*m&&(u=u-k*m));let v=!0;if(r==="right"){const E=Math.floor((u+m/2-1)/m);O(e,E,h,l)||(v=!1,o=(y+1)*m-m/2)}else if(r==="left"){const E=Math.floor((u-m/2)/m);O(e,E,h,l)||(v=!1,o=y*m+m/2)}else if(r==="down"){const E=Math.floor((S+m/2-1)/m);O(e,y,E,l)||(v=!1,d=(h+1)*m-m/2)}else if(r==="up"){const E=Math.floor((S-m/2)/m);O(e,y,E,l)||(v=!1,d=h*m+m/2)}v&&(o=u,d=S,y=Math.floor(o/m),h=Math.floor(d/m),y=Math.max(0,Math.min(k-1,y)),h=Math.max(0,Math.min(e.length-1,h)))}t.entities.addComponent(a,"position",{gridX:y,gridY:h,pixelX:o,pixelY:d}),t.entities.addComponent(a,"velocity",{...c,direction:r,nextDirection:f})}}}}const xe=m*.8,q=[200,400,800,1600];function Re(e,n,t){const i=e.entities.getComponent(n,"position"),s=e.entities.getComponent(t,"position");if(!i||!s)return!1;const a=i.pixelX-s.pixelX,p=i.pixelY-s.pixelY;return Math.sqrt(a*a+p*p)<xe}function De(e){return{update:t=>{if(t.getGameState()!=="playing")return;const i=G(t);if(i===null)return;const s=M(t),a=[];for(const p of s)de(t,p)!=="eaten"&&Re(t,i,p)&&a.push(p);for(const p of a)if(H(t,p)){t.incrementGhostEatenStreak();const l=t.getGhostEatenStreak(),o=q[Math.min(l-1,q.length-1)],d=ue(t,p)||"blinky";t.addScore(o),t.entities.removeComponent(p,"vulnerable");const r=t.entities.getComponent(p,"ghostAI");r&&t.entities.addComponent(p,"ghostAI",{...r,mode:"eaten"});const f=t.entities.getComponent(p,"position");e.dispatch(T.GHOST_EATEN,{ghostId:p,ghostType:d,points:o,streak:l,position:f})}else{t.loseLife();const l=t.getLives();e.dispatch(T.PLAYER_DIED,{livesRemaining:l}),l===0&&(t.setGameState("lost"),e.dispatch(T.GAME_OVER,{finalScore:t.getScore(),level:t.getLevel()}));break}}}}const Me=m*.8;function Oe(e){return{update:t=>{if(t.getGameState()!=="playing"||G(t)===null)return;const s=z(t);if(!s)return;const a=V(t),p=[];for(const c of a){const l=t.entities.getComponent(c,"position");if(!l)continue;const o=s.pixelX-l.pixelX,d=s.pixelY-l.pixelY;Math.sqrt(o*o+d*d)<Me&&p.push(c)}for(const c of p){const l=t.entities.getComponent(c,"edible"),o=t.entities.getComponent(c,"powerUp"),d=t.entities.getComponent(c,"position"),r=(l==null?void 0:l.points)??10;if(t.addScore(r),o){const f=o.duration;t.setPowerUpTime(f),t.resetGhostEatenStreak(),e.dispatch(T.POWER_PELLET_EATEN,{entityId:c,position:d,points:r,duration:f}),e.dispatch(T.POWER_UP_STARTED,{timeRemaining:f})}else e.dispatch(T.PELLET_EATEN,{entityId:c,position:d,points:r});t.entities.destroyEntity(c)}p.length>0&&me(t)===0&&(t.setGameState("won"),e.dispatch(T.LEVEL_COMPLETE,{level:t.getLevel(),score:t.getScore()}))}}}const Ne={blinky:{x:25,y:0},pinky:{x:2,y:0},inky:{x:27,y:30},clyde:{x:0,y:30}};function W(e,n,t,i){return{gridX:e,gridY:n,pixelX:t??e*m+m/2,pixelY:i??n*m+m/2}}function B(e=null,n=0,t=null){return{direction:e,speed:n,nextDirection:t}}function Ue(e,n="scatter"){return{type:e,mode:n,scatterTarget:Ne[e]}}function ee(e=10){return{points:e}}function Y(e=m,n=m){return{width:e,height:n}}function ke(e,n=!1){return{remainingTime:e,flashing:n}}function we(e,n,t=3e3){return{spawnX:e,spawnY:n,delay:t,timer:0}}function He(){return{_tag:"playerControlled"}}function We(e=6e3){return{duration:e}}function Ye(e){let n=!1,t=!1;return{update:s=>{if(s.getGameState()!=="playing")return;const a=s.getDeltaTime(),p=s.getPowerUpTimeRemaining(),c=p>0;if(c&&!n){const l=M(s);for(const o of l)s.entities.hasComponent(o,"vulnerable")||s.entities.addComponent(o,"vulnerable",ke(p));t=!1}if(c){s.decreasePowerUpTime(a);const l=s.getPowerUpTimeRemaining(),o=M(s),d=l<=be;for(const r of o)s.entities.getComponent(r,"vulnerable")&&s.entities.addComponent(r,"vulnerable",{remainingTime:l,flashing:d});if(d&&!t&&(e.dispatch(T.POWER_UP_WARNING,{timeRemaining:l}),t=!0),l===0){for(const r of o)s.entities.removeComponent(r,"vulnerable");s.resetGhostEatenStreak(),e.dispatch(T.POWER_UP_ENDED,void 0)}}n=s.getPowerUpTimeRemaining()>0}}}const te=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,3,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,3,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,1,1,1,5,5,1,1,1,0,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,1,2,2,2,2,2,2,1,0,1,1,0,1,1,1,1,1,1],[4,4,4,4,4,4,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,4,4,4,4,4,4],[1,1,1,1,1,1,0,1,1,0,1,2,2,2,2,2,2,1,0,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,3,0,0,1,1,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,1,1,0,0,3,1],[1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1],[1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1],[1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];function Xe(e,n,t){const i=t===14,s=n<=5||n>=22;switch(e){case 1:return{type:"wall"};case 2:return{type:"ghost-house"};case 5:return{type:"ghost-door"};case 0:case 3:return{type:"path"};case 4:return i&&s?{type:"tunnel"}:{type:"path"};default:return{type:"path"}}}const U=te.map((e,n)=>e.map((t,i)=>Xe(t,i,n))),ne=[{x:1,y:3},{x:26,y:3},{x:1,y:22},{x:26,y:22}],R={x:14,y:22},K={blinky:{x:14,y:11},pinky:{x:14,y:14},inky:{x:12,y:14},clyde:{x:16,y:14}},$e=(()=>{const e=[],n=new Set(ne.map(t=>`${t.x},${t.y}`));return te.forEach((t,i)=>{t.forEach((s,a)=>{s===0&&!n.has(`${a},${i}`)&&e.push({x:a,y:i})})}),e})(),D={blinky:{x:25,y:0},pinky:{x:2,y:0},inky:{x:27,y:30},clyde:{x:0,y:30}},ze={x:13,y:14},Ve=8,N=4;function X(e){return e===null?null:{up:"down",down:"up",left:"right",right:"left"}[e]}function se(e,n,t,i){const s=t-e,a=i-n;return s*s+a*a}const Fe=["up","down","left","right"];function ie(e,n){return n<0||n>=U.length||e<0||e>=U[0].length?!1:U[n][e].type!=="wall"}function w(e,n,t){switch(t){case"up":return{x:e,y:n-1};case"down":return{x:e,y:n+1};case"left":return{x:e-1,y:n};case"right":return{x:e+1,y:n}}}function qe(e,n,t=2){const i=Math.floor(e/m)*m+m/2,s=Math.floor(n/m)*m+m/2;return Math.abs(e-i)<=t&&Math.abs(n-s)<=t}function oe(e,n,t){const i=X(t),s=[];for(const a of Fe){if(a===i)continue;const p=w(e,n,a);ie(p.x,p.y)&&s.push(a)}return s}function Ke(e,n,t,i,s){const a=oe(e,n,s);if(a.length===0){const o=X(s);return o&&ie(w(e,n,o).x,w(e,n,o).y)?o:null}if(a.length===1)return a[0];const p=["up","left","down","right"];let c=a[0],l=1/0;for(const o of p){if(!a.includes(o))continue;const d=w(e,n,o),r=se(d.x,d.y,t,i);r<l&&(l=r,c=o)}return c}function Z(e,n,t){const i=oe(e,n,t);return i.length===0?X(t):i[Math.floor(Math.random()*i.length)]}function Ze(e){let n="scatter",t=!1,i=!1;const s=new Set;e.subscribe(T.GHOST_MODE_CHANGE,o=>{n=o.mode,t=!0}),e.subscribe(T.POWER_UP_STARTED,()=>{i=!0,t=!0}),e.subscribe(T.POWER_UP_ENDED,()=>{i=!1,t=!0}),e.subscribe(T.GHOST_EATEN,o=>{s.add(o.ghostId)});const a=(o,d)=>{const r=o.entities.getComponent(d,"ghostAI");if(!r)return null;const f=r.type,y=r.mode;if(y==="eaten")return ze;if(y==="frightened"||H(o,d))return null;if(y==="scatter"||G(o)===null)return D[f];const g=z(o);if(!g)return D[f];switch(f){case"blinky":return{x:g.gridX,y:g.gridY};case"pinky":{const u=$(o);let S=g.gridX,v=g.gridY;return u==="up"?(v-=N,S-=N):u==="down"?v+=N:u==="left"?S-=N:u==="right"&&(S+=N),{x:S,y:v}}case"inky":{const u=p(o,"blinky");if(u===null)return{x:g.gridX,y:g.gridY};const S=o.entities.getComponent(u,"position");if(!S)return{x:g.gridX,y:g.gridY};const v=$(o);let E=g.gridX,C=g.gridY;v==="up"?C-=2:v==="down"?C+=2:v==="left"?E-=2:v==="right"&&(E+=2);const A=E+(E-S.gridX),b=C+(C-S.gridY);return{x:A,y:b}}case"clyde":{const u=o.entities.getComponent(d,"position");return u&&Math.sqrt(se(u.gridX,u.gridY,g.gridX,g.gridY))>Ve?{x:g.gridX,y:g.gridY}:D.clyde}default:return D[f]}};function p(o,d){const r=M(o);for(const f of r){const y=o.entities.getComponent(f,"ghostAI");if((y==null?void 0:y.type)===d)return f}return null}function c(o,d){const r=o.entities.getComponent(d,"ghostAI"),f=o.entities.getComponent(d,"velocity"),y=o.entities.getComponent(d,"position");if(!r||!f||!y)return;const h=H(o,d),g=s.has(d);let u=r.mode;g?(u="eaten",y.gridX>=13&&y.gridX<=14&&y.gridY===14&&(s.delete(d),u=n)):h||i?u="frightened":u=n,u!==r.mode&&o.entities.addComponent(d,"ghostAI",{...r,mode:u});const S=h?Te:j;if(t&&f.direction!==null){const C=X(f.direction);o.entities.addComponent(d,"velocity",{...f,speed:S,direction:C});return}const v=qe(y.pixelX,y.pixelY);if(f.direction===null||v){const{gridX:C,gridY:A}=y,b=a(o,d);let _=null;u==="frightened"?_=Z(C,A,f.direction):b?_=Ke(C,A,b.x,b.y,f.direction):_=Z(C,A,f.direction),_!==null&&_!==f.direction?o.entities.addComponent(d,"velocity",{...f,speed:S,direction:_}):f.speed!==S&&o.entities.addComponent(d,"velocity",{...f,speed:S})}else f.speed!==S&&o.entities.addComponent(d,"velocity",{...f,speed:S})}return{update:o=>{if(o.getGameState()!=="playing")return;const d=M(o);for(const r of d)c(o,r);t=!1},getGhostTarget:a}}const Je=2,je=1.8;function Qe(e,n,t){const i=e.entities.createEntity();return e.entities.addComponent(i,"position",W(n,t)),e.entities.addComponent(i,"velocity",B(null,Je)),e.entities.addComponent(i,"playerControlled",He()),e.entities.addComponent(i,"collider",Y()),i}function Be(e,n,t,i){const s=e.entities.createEntity();return e.entities.addComponent(s,"position",W(t,i)),e.entities.addComponent(s,"velocity",B(null,je)),e.entities.addComponent(s,"ghostAI",Ue(n)),e.entities.addComponent(s,"collider",Y()),e.entities.addComponent(s,"respawnable",we(t,i)),s}function et(e,n,t){const i=e.entities.createEntity();return e.entities.addComponent(i,"position",W(n,t)),e.entities.addComponent(i,"edible",ee(10)),e.entities.addComponent(i,"collider",Y()),i}function tt(e,n,t){const i=e.entities.createEntity();return e.entities.addComponent(i,"position",W(n,t)),e.entities.addComponent(i,"edible",ee(50)),e.entities.addComponent(i,"powerUp",We(6e3)),e.entities.addComponent(i,"collider",Y()),i}function nt(){const e=ce(),n=le(),t={input:Ce(n),movement:Ie(U),collision:De(n),eating:Oe(n),powerUp:Ye(n),ghostAI:Ze(n)};let i=0,s=!0;const a=new Map;let p=!1,c=0;n.subscribe(T.GAME_RESTART,()=>{p=!0}),n.subscribe(T.PLAYER_DIED,g=>{g.livesRemaining>0&&(e.setGameState("dying"),c=Pe)});const l=()=>{const g=G(e);g!==null&&(e.entities.addComponent(g,"position",{gridX:R.x,gridY:R.y,pixelX:R.x*m+m/2,pixelY:R.y*m+m/2}),e.entities.addComponent(g,"velocity",{direction:null,speed:ve,nextDirection:null}));const u=["blinky","pinky","inky","clyde"];for(const S of u){const v=a.get(S);if(v!==void 0){const E=K[S];e.entities.addComponent(v,"position",{gridX:E.x,gridY:E.y,pixelX:E.x*m+m/2,pixelY:E.y*m+m/2}),e.entities.addComponent(v,"velocity",{direction:null,speed:j,nextDirection:null});const C=e.entities.getComponent(v,"ghostAI");C&&e.entities.addComponent(v,"ghostAI",{...C,mode:"scatter"}),e.entities.removeComponent(v,"vulnerable")}}e.setPowerUpTime(0),e.resetGhostEatenStreak(),i=0,s=!0},o=()=>{e.reset(),i=0,s=!0,Qe(e,R.x,R.y),a.clear();const g=["blinky","pinky","inky","clyde"];for(const u of g){const S=K[u],v=Be(e,u,S.x,S.y);a.set(u,v)}for(const u of $e)et(e,u.x,u.y);for(const u of ne)tt(e,u.x,u.y);e.setGameState("ready")};return{getWorld:()=>e,getEventBus:()=>n,init:o,update:g=>{if(p){p=!1,o();return}if(e.setDeltaTime(g),e.getGameState()==="dying"){c-=g,c<=0&&(l(),e.setGameState("playing"));return}e.getGameState()==="playing"&&!e.isPowerUpActive()&&(i+=g,i>=(s?_e:Ae)&&(i=0,s=!s,n.dispatch(T.GHOST_MODE_CHANGE,{mode:s?"scatter":"chase"}))),t.input.update(e),t.ghostAI.update(e),t.movement.update(e),t.eating.update(e),t.powerUp.update(e),t.collision.update(e)},start:()=>{e.getGameState()==="ready"&&(e.setGameState("playing"),n.dispatch(T.GAME_STARTED,void 0))},pause:()=>{e.getGameState()==="playing"&&(e.setGameState("paused"),n.dispatch(T.GAME_PAUSED,void 0))},resume:()=>{e.getGameState()==="paused"&&(e.setGameState("playing"),n.dispatch(T.GAME_RESUMED,void 0))},destroy:()=>{t.input.destroy(),n.clear()}}}function st(e){const{score:n,highScore:t,lives:i,level:s}=e,a=document.createElement("div");a.classList.add("scoreboard"),a.dataset.score=String(n),a.dataset.highScore=String(t),a.dataset.lives=String(i),a.dataset.level=String(s),a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),a.setAttribute("aria-label","Game scoreboard");const p=document.createElement("div");p.classList.add("scoreboard__score");const c=document.createElement("div");c.classList.add("scoreboard__score-label"),c.textContent="SCORE";const l=document.createElement("div");l.classList.add("scoreboard__score-value"),l.textContent=String(n),p.appendChild(c),p.appendChild(l);const o=document.createElement("div");o.classList.add("scoreboard__highscore");const d=document.createElement("div");d.classList.add("scoreboard__highscore-label"),d.textContent="HIGH SCORE";const r=document.createElement("div");r.classList.add("scoreboard__highscore-value"),r.textContent=String(t),o.appendChild(d),o.appendChild(r);const f=document.createElement("div");f.classList.add("scoreboard__lives");for(let u=0;u<i;u++){const S=document.createElement("div");S.classList.add("scoreboard__life"),f.appendChild(S)}const y=document.createElement("div");y.classList.add("scoreboard__level");const h=document.createElement("div");h.classList.add("scoreboard__level-label"),h.textContent="LEVEL";const g=document.createElement("div");return g.classList.add("scoreboard__level-value"),g.textContent=String(s),y.appendChild(h),y.appendChild(g),a.appendChild(p),a.appendChild(o),a.appendChild(f),a.appendChild(y),a}function it(e){const{type:n="path"}=e,t=document.createElement("div");return t.classList.add("maze-cell"),t.classList.add(`maze-cell--${n}`),t.dataset.cellType=n,t.setAttribute("role","presentation"),t}function ot(e){const{mazeData:n,cellSize:t=20}=e,i=document.createElement("div");i.classList.add("maze-layout"),i.style.setProperty("--cell-size",`${t}px`);const s=n.length,a=s>0?n[0].length:0;return i.dataset.cellSize=String(t),i.dataset.width=String(a),i.dataset.height=String(s),i.setAttribute("role","grid"),i.setAttribute("aria-label","Game maze"),n.forEach((p,c)=>{const l=document.createElement("div");l.classList.add("maze-layout__row"),l.setAttribute("role","row"),p.forEach((o,d)=>{const r=it({type:o.type});r.setAttribute("data-x",String(d)),r.setAttribute("data-y",String(c)),l.appendChild(r)}),i.appendChild(l)}),i}function at(e){const{score:n,highScore:t,lives:i,level:s,mazeData:a,cellSize:p=20,showOverlay:c=!1,overlayMessage:l=""}=e,o=document.createElement("div");o.classList.add("game-layout"),o.dataset.score=String(n),o.dataset.level=String(s),o.dataset.lives=String(i),o.setAttribute("role","application"),o.setAttribute("aria-label","Pacman game");const d=st({score:n,highScore:t,lives:i,level:s}),r=document.createElement("div");r.classList.add("game-layout__maze-container");const f=ot({mazeData:a,cellSize:p});if(r.appendChild(f),c&&l){const y=document.createElement("div");y.classList.add("game-layout__overlay");const h=document.createElement("div");h.classList.add("game-layout__message"),h.textContent=l,y.appendChild(h),r.appendChild(y)}return o.appendChild(d),o.appendChild(r),o}function rt(e){const{direction:n="right",eating:t=!1}=e,i=document.createElement("div");return i.classList.add("pacman"),i.classList.add(`pacman--${n}`),t&&i.classList.add("pacman--eating"),i.dataset.direction=n,i.dataset.eating=String(t),i.setAttribute("role","img"),i.setAttribute("aria-label","Pacman"),i}function ct(e){const{type:n,state:t="normal",lookDirection:i="right"}=e,s=document.createElement("div");s.classList.add("ghost"),s.classList.add(`ghost--${n}`),t==="frightened"?s.classList.add("ghost--frightened"):t==="flashing"?(s.classList.add("ghost--frightened"),s.classList.add("ghost--flashing")):t==="eyes-only"&&s.classList.add("ghost--eyes-only"),s.classList.add(`ghost--look-${i}`),s.dataset.type=n,s.dataset.state=t,s.dataset.lookDirection=i,s.setAttribute("role","img");const a=n.charAt(0).toUpperCase()+n.slice(1),p=t==="frightened"||t==="flashing"?`${a} ghost (frightened)`:`${a} ghost`;s.setAttribute("aria-label",p);const c=document.createElement("div");c.classList.add("ghost__body");const l=document.createElement("div");l.classList.add("ghost__eyes");const o=document.createElement("div");o.classList.add("ghost__eye");const d=document.createElement("div");d.classList.add("ghost__pupil"),o.appendChild(d);const r=document.createElement("div");r.classList.add("ghost__eye");const f=document.createElement("div");f.classList.add("ghost__pupil"),r.appendChild(f),l.appendChild(o),l.appendChild(r),c.appendChild(l);const y=document.createElement("div");y.classList.add("ghost__skirt");for(let h=0;h<3;h++){const g=document.createElement("div");g.classList.add("ghost__skirt-wave"),y.appendChild(g)}return s.appendChild(c),s.appendChild(y),s}function lt(e){const{size:n="small"}=e,t=document.createElement("div");return t.classList.add("pellet"),t.classList.add(`pellet--${n}`),t.setAttribute("role","img"),t.setAttribute("aria-label","pellet"),t}function dt(e){const{animated:n=!0}=e,t=document.createElement("div");return t.classList.add("power-pellet"),n&&t.classList.add("power-pellet--animated"),t.setAttribute("role","img"),t.setAttribute("aria-label","power pellet"),t}function ut(e,n,t={}){const{cellSize:i=m,highScore:s=0}=t;let a=null,p=0,c=null;const l=()=>{const E=e.getWorld();switch(Se(E)){case"ready":return{show:!0,message:"Ready!"};case"paused":return{show:!0,message:"Paused"};case"won":return{show:!0,message:"You Win!"};case"lost":return{show:!0,message:"Game Over"};case"dying":return{show:!0,message:"Oops!"};default:return{show:!1,message:""}}},o=E=>E.mode==="eaten"?"eyes-only":E.isFlashing?"flashing":E.isVulnerable?"frightened":"normal",d=()=>{const E=document.createElement("div");return E.classList.add("entity-layer"),E.style.position="absolute",E.style.top="0",E.style.left="0",E.style.width="100%",E.style.height="100%",E.style.pointerEvents="none",E},r=E=>{const C=e.getWorld(),A=z(C),b=$(C);if(!A)return;const _=rt({direction:b||"right",eating:!1});_.style.position="absolute",_.style.left=`${A.pixelX}px`,_.style.top=`${A.pixelY}px`,E.appendChild(_)},f=E=>{const C=e.getWorld(),A=fe(C);for(const b of A){const _=C.entities.getComponent(b.id,"velocity"),I=(_==null?void 0:_.direction)||"right",L=ct({type:b.type,state:o(b),lookDirection:I});L.style.position="absolute",L.style.left=`${b.position.pixelX}px`,L.style.top=`${b.position.pixelY}px`,L.style.transform="translate(-50%, -50%)",E.appendChild(L)}},y=E=>{const C=e.getWorld(),A=V(C),b=new Set(ge(C));for(const _ of A){const I=C.entities.getComponent(_,"position");if(!I)continue;const x=b.has(_)?dt({animated:!0}):lt({size:"small"});x.style.position="absolute",x.style.left=`${I.gridX*i+i/2}px`,x.style.top=`${I.gridY*i+i/2}px`,x.style.transform="translate(-50%, -50%)",E.appendChild(x)}},h=()=>{const E=e.getWorld(),C=l();n.innerHTML="";const A=at({score:he(E),highScore:s,lives:ye(E),level:Ee(E),mazeData:U,cellSize:i,showOverlay:C.show,overlayMessage:C.message}),b=A.querySelector(".game-layout__maze-container");b&&(b.style.position="relative",c=d(),y(c),r(c),f(c),b.appendChild(c)),n.appendChild(A)},g=E=>{const C=p===0?16:E-p;p=E,e.update(C),h(),a=requestAnimationFrame(g)},u=()=>{a===null&&(p=0,a=requestAnimationFrame(g))},S=()=>{a!==null&&(cancelAnimationFrame(a),a=null)};return{render:h,start:u,stop:S,destroy:()=>{S(),n.innerHTML="",c=null}}}const pt={arrowleft:"left",arrowright:"right",arrowup:"up",arrowdown:"down",a:"left",d:"right",w:"up",s:"down"},ft=new Set(["arrowleft","arrowright","arrowup","arrowdown"," "]);function gt(e){const n=i=>{const s=i.key.toLowerCase();if(ft.has(s)&&i.preventDefault(),i.repeat)return;const a=pt[s];if(a){e.dispatch(T.INPUT_DIRECTION,{direction:a});return}if(s==="enter"||s===" "){i.preventDefault(),e.dispatch(T.INPUT_START,void 0);return}if(s==="p"||s==="escape"){e.dispatch(T.INPUT_PAUSE,void 0);return}if(s==="r"){e.dispatch(T.INPUT_RESTART,void 0);return}};return window.addEventListener("keydown",n),{destroy:()=>{window.removeEventListener("keydown",n)}}}function J(){const e=document.getElementById("app");if(!e)throw new Error("Could not find #app container element");const n=nt();n.init();const t=ut(n,e,{cellSize:m,highScore:mt()}),i=gt(n.getEventBus());t.start(),window.addEventListener("beforeunload",()=>{t.destroy(),i.destroy(),n.destroy()}),t.render()}function mt(){try{const e=localStorage.getItem("pacman-high-score");return e?parseInt(e,10):0}catch{return 0}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",J):J();
